cmake_minimum_required(VERSION 2.8)

if(POLICY CMP0020)
  cmake_policy(SET CMP0020 NEW)
endif()
if(POLICY CMP0042)
  cmake_policy(SET CMP0042 NEW)
endif()
if(POLICY CMP0048)
  cmake_policy(SET CMP0048 NEW)
endif()

add_subdirectory(QEverCloud)
get_directory_property(QEVERCLOUD_LIB DIRECTORY QEverCloud DEFINITION PROJECT_NAME)
get_directory_property(QEVERCLOUD_SOURCES DIRECTORY QEverCloud DEFINITION SOURCES)
get_directory_property(QEVERCLOUD_INCLUDE_DIRS DIRECTORY QEverCloud DEFINITION INCLUDE_DIRS)

if((NOT USE_SYSTEM_QT_KEYCHAIN) AND EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/qtkeychain/CMakeLists.txt)
  message(STATUS "Found Qt Keychain sources in 3rdparty folder, will use them to build the local lib instead of attempting to find the existing installation")
  add_subdirectory(qtkeychain)
  get_directory_property(QTKEYCHAIN_LIB DIRECTORY qtkeychain DEFINITION QTKEYCHAIN_TARGET_NAME)
  get_directory_property(QTKEYCHAIN_SOURCES DIRECTORY qtkeychain DEFINITION SOURCES)
  get_directory_property(QTKEYCHAIN_INCLUDE_PATH DIRECTORY qtkeychain DEFINITION INCLUDE_DIRS)
else()
  if(USE_SYSTEM_QT_KEYCHAIN)
    message(STATUS "USE_SYSTEM_QT_KEYCHAIN option is set, will try to find the existing installation of Qt Keychain")
  else()
    message(STATUS "Haven't found Qt Keychain sources in 3rdparty folder, will try to find the existing installation")
  endif()
  include(LibquentierFindQtKeychain)
endif()

if((NOT USE_SYSTEM_QSLOG) AND EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/qslog/CMakeLists.txt)
  message(STATUS "Found QsLog sources in 3rdparty folder, will use them to build the local lib instead of attempting to find the existing installation")
  add_subdirectory(qslog)
  get_directory_property(QSLOG_LIB DIRECTORY qslog DEFINITION PROJECT_NAME)
  get_directory_property(QSLOG_SOURCES DIRECTORY qslog DEFINITION SOURCES)
  get_directory_property(QSLOG_INCLUDE_PATH DIRECTORY qslog DEFINITION INCLUDE_DIRS)
else()
  if(USE_SYSTEM_QSLOG)
    message(STATUS "USE_SYSTEM_QSLOG option is set, will try to find the existing installation of QsLog")
  else()
    message(STATUS "Haven't found QsLog sources in 3rdparty folder, will try to find the existing installation")
  endif()
  include(FindQsLog)
endif()

if((NOT USE_SYSTEM_TIDY_HTML5) AND EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/tidy-html5/CMakeLists.txt)
  message(STATUS "Found tidy-html5 sources in 3rdparty folder, will use them to build the local lib instead of attempting to find the existing installation")
  add_subdirectory(tidy-html5)
  get_directory_property(TIDY_HTML5_LIB DIRECTORY tidy-html5 DEFINITION PROJECT_NAME)
  get_directory_property(TIDY_HTML5_SOURCES DIRECTORY tidy-html5 DEFINITION SOURCES)
  get_directory_property(TIDY_HTML5_INCLUDE_PATH DIRECTORY tidy-html5 DEFINITION INCLUDE_DIRS)
else()
  if(USE_SYSTEM_TIDY_HTML5)
    message(STATUS "USE_SYSTEM_TIDY_HTML5 option is set, will try to find the existing installation of tidy-html5")
  else()
    message(STATUS "Haven't found tidy-html5 sources in 3rdparty folder, will try to find the existing installation")
  endif()
  include(FindTidyHtml5)
endif()

if((NOT USE_SYSTEM_SIMPLECRYPT) AND EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/simplecrypt/CMakeLists.txt)
  message(STATUS "Found SimpleCrypt sources in 3rdparty folder, will use them to build the local lib instead of attempting to find the existing installation")
  add_subdirectory(simplecrypt)
  get_directory_property(SIMPLECRYPT_LIB DIRECTORY simplecrypt DEFINITION PROJECT_NAME)
  get_directory_property(SIMPLECRYPT_SOURCES DIRECTORY simplecrypt DEFINITION SOURCES)
  get_directory_property(SIMPLECRYPT_INCLUDE_PATH DIRECTORY simplecrypt DEFINITION INCLUDE_DIRS)
else()
  if(USE_SYSTEM_SIMPLECRYPT)
    message(STATUS "USE_SYSTEM_SIMPLECRYPT option is set, will try to find the existing installation of SimpleCrypt")
  else()
    message(STATUS "Haven't found SimpleCrypt sources in 3rdparty folder, will try to find the existing installation")
  endif()
  include(FindSimpleCrypt)
endif()

if(NOT USE_QT5)
  if((NOT USE_SYSTEM_QT4_MIMETYPES) AND EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/qt4-mimetypes/CMakeLists.txt)
    message(STATUS "Found Qt4 Mimetypes sources in 3rdparty folder, will use them to build the local lib instead of attempting to find the existing installation")
    add_subdirectory(qt4-mimetypes)
    get_directory_property(QT4_MIMETYPES_LIB DIRECTORY qt4-mimetypes DEFINITION PROJECT_NAME)
    get_directory_property(QT4_MIMETYPES_SOURCES DIRECTORY qt4-mimetypes DEFINITION SOURCES)
    get_directory_property(QT4_MIMETYPES_INCLUDE_PATH DIRECTORY qt4-mimetypes DEFINITION INCLUDE_DIRS)
  else()
    if(USE_SYSTEM_QT4_MIMETYPES)
      message(STATUS "USE_SYSTEM_QT4_MIMETYPES option is set, will try to find the existing installation of Qt4 Mimetypes")
    else()
      message(STATUS "Haven't found Qt4 Mimetypes sources in 3rdparty folder, will try to find the existing installation")
    endif()
    include(FindQt4Mimetypes)
  endif()
endif()

if(NOT ${CMAKE_SYSTEM_NAME} STREQUAL "Windows")
  add_subdirectory(stacktrace)
  get_directory_property(STACKTRACE_LIB DIRECTORY stacktrace DEFINITION PROJECT_NAME)
  get_directory_property(STACKTRACE_SOURCES DIRECTORY stacktrace DEFINITION SOURCES)
  get_directory_property(STACKTRACE_INCLUDE_PATH DIRECTORY stacktrace DEFINITION INCLUDE_DIRS)
endif()

set(THIRDPARTY_INCLUDE_DIRS ${SIMPLECRYPT_INCLUDE_PATH})
list(APPEND THIRDPARTY_INCLUDE_DIRS ${QEVERCLOUD_INCLUDE_DIRS})
list(APPEND THIRDPARTY_INCLUDE_DIRS ${QTKEYCHAIN_INCLUDE_PATH})
list(APPEND THIRDPARTY_INCLUDE_DIRS ${QSLOG_INCLUDE_PATH})
list(APPEND THIRDPARTY_INCLUDE_DIRS ${TIDY_HTML5_INCLUDE_PATH})
list(APPEND THIRDPARTY_INCLUDE_DIRS ${HUNSPELL_INCLUDE_DIR})

set(THIRDPARTY_SOURCES
    ${SIMPLECRYPT_SOURCES}
    ${QEVERCLOUD_SOURCES}
    ${QTKEYCHAIN_SOURCES}
    ${QSLOG_SOURCES}
    ${TIDY_HTML5_SOURCES})

if(NOT USE_QT5)
  list(APPEND THIRDPARTY_INCLUDE_DIRS ${QT4_MIMETYPES_INCLUDE_PATH})
  list(APPEND THIDRPARTY_SOURCES ${QT4_MIMETYPES_SOURCES})
endif()

if(NOT ${CMAKE_SYSTEM_NAME} STREQUAL "Windows")
  list(APPEND THIRDPARTY_INCLUDE_DIRS ${STACKTRACE_INCLUDE_PATH})
  list(APPEND THIRDPARTY_SOURCES ${STACKTRACE_SOURCES})
endif()

list(APPEND THIRDPARTY_INCLUDE_DIRS "${CMAKE_CURRENT_SOURCE_DIR}")
